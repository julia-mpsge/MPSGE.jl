<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Production Blocks · MPSGE.jl</title><meta name="title" content="Production Blocks · MPSGE.jl"/><meta property="og:title" content="Production Blocks · MPSGE.jl"/><meta property="twitter:title" content="Production Blocks · MPSGE.jl"/><meta name="description" content="Documentation for MPSGE.jl."/><meta property="og:description" content="Documentation for MPSGE.jl."/><meta property="twitter:description" content="Documentation for MPSGE.jl."/><meta property="og:url" content="https://julia-mpsge.github.io/MPSGE.jl/overview/production/"/><meta property="twitter:url" content="https://julia-mpsge.github.io/MPSGE.jl/overview/production/"/><link rel="canonical" href="https://julia-mpsge.github.io/MPSGE.jl/overview/production/"/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">MPSGE.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><span class="tocitem">Introduction</span><ul><li><a class="tocitem" href="../../">MPSGE</a></li></ul></li><li><span class="tocitem">Overview</span><ul><li><a class="tocitem" href="../introduction/">Overview of MPSGE</a></li><li><a class="tocitem" href="../variables/">MPSGE Variables</a></li><li class="is-active"><a class="tocitem" href>Production Blocks</a><ul class="internal"><li><a class="tocitem" href="#Netputs"><span>Netputs</span></a></li><li><a class="tocitem" href="#Nests"><span>Nests</span></a></li><li><a class="tocitem" href="#Nodes"><span>Nodes</span></a></li><li><a class="tocitem" href="#Building-Cost-Functions"><span>Building Cost Functions</span></a></li></ul></li><li><a class="tocitem" href="../demand/">Demand Blocks</a></li></ul></li><li><span class="tocitem">Tutorials</span><ul><li><input class="collapse-toggle" id="menuitem-3-1" type="checkbox"/><label class="tocitem" for="menuitem-3-1"><span class="docs-label">Getting Started</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../Tutorials/getting_started/introduction/">Introduction</a></li><li><a class="tocitem" href="../../Tutorials/getting_started/first_example/">Getting Started with MPSGE</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-2" type="checkbox"/><label class="tocitem" for="menuitem-3-2"><span class="docs-label">Intermediate Examples</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../Tutorials/intermediate_examples/m22/">Closed <span>$2\times2$</span> Economy with Intermediate Inputs and Nesting</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-3" type="checkbox"/><label class="tocitem" for="menuitem-3-3"><span class="docs-label">Robinson Crusoe</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../Tutorials/robinson_crusoe/introduction/">Robinson Crusoe - Introduction</a></li><li><a class="tocitem" href="../../Tutorials/robinson_crusoe/basic_rc/">One Consumer, One Producer, Two Goods</a></li></ul></li></ul></li><li><span class="tocitem">Mathematical Background</span><ul><li><a class="tocitem" href="../../how_it_works/">How MPSGE Works</a></li></ul></li><li><span class="tocitem">API Reference</span><ul><li><a class="tocitem" href="../../docs/">API Reference</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Overview</a></li><li class="is-active"><a href>Production Blocks</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Production Blocks</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/julia-mpsge/MPSGE.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/julia-mpsge/MPSGE.jl/blob/main/docs/src/overview/production.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Production-Blocks"><a class="docs-heading-anchor" href="#Production-Blocks">Production Blocks</a><a id="Production-Blocks-1"></a><a class="docs-heading-anchor-permalink" href="#Production-Blocks" title="Permalink"></a></h1><p>Production blocks build cost functions. To build a cost function, we need to specify the inputs (costs) and outputs (revenues) of the production process. In MPSGE, production blocks are created using the <a href="../../docs/#MPSGE.@production-Tuple"><code>@production</code></a> macro. The documentation for the <code>@production</code> macro does a great job of explaining the syntax and options available when defining a production block, but there is a lot going on behind the scenes that is not immediately obvious. This section aims to clarify some of those details.</p><h2 id="Netputs"><a class="docs-heading-anchor" href="#Netputs">Netputs</a><a id="Netputs-1"></a><a class="docs-heading-anchor-permalink" href="#Netputs" title="Permalink"></a></h2><p>A netput is general term for an <a href="../../docs/#MPSGE.@input-Tuple"><code>@input</code></a> or <a href="../../docs/#MPSGE.@output-Tuple"><code>@output</code></a>. A netput is a leaf in the production tree structure, acting as the initial information for building the cost functions. A netput stores the following information:</p><ul><li><code>commodity</code>: A commodity variable acting as the price.</li><li><code>quantity</code>: This acts more as a reference quantity. If the reference price is 1 this can be thought of as the total value exclusive of tax. This will be discussed below.</li><li><code>parent</code>: The nest that this netput belongs to.</li><li><code>reference_price = 1</code>: The price at the reference quantity, defaulting to 1.</li><li><code>taxes = []</code>: A vector of taxes applied to this netput, defaulting to no taxes.</li><li><code>netput_sign</code>: A value of <code>-1</code> for inputs and <code>1</code> for outputs.</li></ul><p>The &quot;cost function&quot; of a netput is the adjusted price. For example, if the commodity is <span>$P$</span>, the reference price is <span>$P_0$</span>, and there is are taxes <span>$\tau_i$</span>, then the final price, <span>$\bar{P}$</span>, of the netput is given by:</p><p class="math-container">\[\bar{P}  = \frac{P\cdot(1 \mp \sum_i \tau)}{P_0}\]</p><p>where the <span>$\mp$</span> is determined by the <code>netput_sign</code> (use <code>-</code> for outputs and <code>+</code> for inputs). </p><div class="admonition is-info" id="\\mp-vs-\\pm-f536dbb784b0ee6b"><header class="admonition-header">$\mp$ vs $\pm$<a class="admonition-anchor" href="#\\mp-vs-\\pm-f536dbb784b0ee6b" title="Permalink"></a></header><div class="admonition-body"><p>I&#39;ve used <span>$\mp$</span> here to indicate that the sign is opposite of the netput sign. This may change in the future, but will be documented clearly if it does.</p></div></div><p>If <span>$Q$</span> is the reference quantity, then the effective quantity, <span>$\bar{Q}$</span>, is given by:</p><p class="math-container">\[\bar{Q} = Q \cdot P_0\]</p><p>Using this, the total value at the benchmark point is given by:</p><p class="math-container">\[\bar{P}\cdot \bar{Q} = P\cdot Q \cdot (1 \mp \sum_i \tau)\]</p><p>Notice that on the input side, the reference quantity should be <strong>exclusive</strong> of taxes, while on the output side, the reference quantity should be <strong>inclusive</strong> of taxes. The corresponding tax revenue is assigned to the consumer specified in the tax definition.</p><h2 id="Nests"><a class="docs-heading-anchor" href="#Nests">Nests</a><a id="Nests-1"></a><a class="docs-heading-anchor-permalink" href="#Nests" title="Permalink"></a></h2><p>The third argument to the <a href="../../docs/#MPSGE.@production-Tuple"><code>@production</code></a> macro is a list of nests with elasticities. These nests define a tree structure that describes how inputs/outputs are combined in the production process. </p><p>There must always be exactly two nests with no parents, which represent the top-level input and output nests. These are denoted <code>nest_name = elasticity</code>. By convention we use <code>s</code> for the input nest, short for <code>elasticity of substitution</code> and <code>t</code> for the output nest, short for <code>elasticity of transformation</code>. However, we are free to use any names we like for the nests. Top level nests are not allowed to be indexed, mathematically these are defining the roots of the input and output trees.</p><p>Lower-level nests are defined using the syntax <code>child_nest =&gt; parent_nest = elasticity</code>, which indicates that <code>child_nest</code> is a child of <code>parent_nest</code> with the specified elasticity. Child nests can be indexed, for example if goods can be obtained per region and each region has its own elasticity, you could define <code>region_nest[r=region] =&gt; s = elasticity[r]</code>. </p><div class="admonition is-info" id="Images-3d37638a590fb2d2"><header class="admonition-header">Images<a class="admonition-anchor" href="#Images-3d37638a590fb2d2" title="Permalink"></a></header><div class="admonition-body"><p>This section could use some images to illustrate the nest structure.</p></div></div><div class="admonition is-info" id="Nest-Names-4f2062bb9c3d5d7d"><header class="admonition-header">Nest Names<a class="admonition-anchor" href="#Nest-Names-4f2062bb9c3d5d7d" title="Permalink"></a></header><div class="admonition-body"><p>Nests have names given by the base name and index. However, it is currently not clear how to access nests by name. This will be updated soon.</p></div></div><h2 id="Nodes"><a class="docs-heading-anchor" href="#Nodes">Nodes</a><a id="Nodes-1"></a><a class="docs-heading-anchor-permalink" href="#Nodes" title="Permalink"></a></h2><p>Nodes are not typically used by the end user, but they are important to understand how MPSGE builds cost functions. A node is an internal representation of a non-leaf vertex in the production tree. Each node stores the following information:</p><ul><li><code>model</code>: A reference to the MPSGE model.</li><li><code>parent</code>: The parent node, defaults to <code>nothing</code> for the root nodes.</li><li><code>children</code>: A vector of child nodes or netputs.</li><li><code>data</code>: A reference to the nest that defines the node</li><li><code>cost_function_virtual</code>: The variable representing the cost function at this node.</li><li><code>cost_function</code>: The cost function associated with the node.</li><li><code>netput_sign</code>: A value of <code>-1</code> for input nests and <code>1</code> for output nests.</li></ul><div class="admonition is-info" id="Refactoring-Nodes-5b2115d9d3324c3b"><header class="admonition-header">Refactoring Nodes<a class="admonition-anchor" href="#Refactoring-Nodes-5b2115d9d3324c3b" title="Permalink"></a></header><div class="admonition-body"><p>Nodes are in need of refactoring. There are many places where the code is more complicated than it needs to be and could be improved for performance. This will be addressed in a future release.</p></div></div><p>Nodes are responsible for building and storing the cost functions. Cost functions are built recursively, the cost function for a node depends on the cost functions of its children. Cost functions can get large and may be repeated many times. Because of this, an optimization is performed where cost functions are stored as variables in the underlying JuMP model. This significantly reduces the size of the generated model and speeds up solving time as large expressions do not need to be re-evaluated.</p><h2 id="Building-Cost-Functions"><a class="docs-heading-anchor" href="#Building-Cost-Functions">Building Cost Functions</a><a id="Building-Cost-Functions-1"></a><a class="docs-heading-anchor-permalink" href="#Building-Cost-Functions" title="Permalink"></a></h2><p>Cost functions are built recursively starting from the leaves of the production tree (the netputs) and working up to the root nodes. This process will best be described with an example. </p><p>We will focus on the input side, as the output side is analogous. Consider a production block with the following structure:</p><pre><code class="nohighlight hljs">          (s)
         /   \
        /     \
(P_X, Q_X)    (P_Y, Q_Y)</code></pre><p>Or one top level nest <code>s</code> with two inputs <code>X</code> and <code>Y</code>. The cost functions for the two leaves are given above. Let <span>$Q_T = Q_X + Q_Y$</span> be the total reference quantity for the nest <code>s</code>. The CES cost function with elasticity <span>$\sigma\ne1$</span> for the top-level nest <code>s</code> is given by:</p><p class="math-container">\[\begin{align*}
  CF(s) = &amp;  Q_T \cdot \left( \frac{Q_X}{Q_T}\cdot CF(X)^{1-\sigma} + \frac{Q_Y}{Q_T}\cdot CF(Y)^{1-\sigma}   \right) ^ {\frac{1}{1-\sigma}} \\
   = &amp; Q_T \cdot \left( \frac{Q_X}{Q_T}\cdot (P_X)^{1-\sigma} + \frac{Q_Y}{Q_T}\cdot (P_Y)^{1-\sigma}   \right) ^ {\frac{1}{1-\sigma}}
\end{align*}\]</p><div class="admonition is-info" id="Clarity-1a33b65a0f452016"><header class="admonition-header">Clarity<a class="admonition-anchor" href="#Clarity-1a33b65a0f452016" title="Permalink"></a></header><div class="admonition-body"><p>This is feels a little off. Verify this is correct and generalizes correctly.</p></div></div><p>This example generalizes to more complex nest structures by recursively applying the same logic. Each node computes its cost function based on the cost functions of its children, ultimately leading to the top-level cost functions for inputs and outputs.</p><div class="admonition is-info" id="More-Detail-8cda7e4970514726"><header class="admonition-header">More Detail<a class="admonition-anchor" href="#More-Detail-8cda7e4970514726" title="Permalink"></a></header><div class="admonition-body"><p>This section could be expanded with more mathematical detail and examples. Consider adding examples with multiple nests and indexed nests.</p></div></div></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../variables/">« MPSGE Variables</a><a class="docs-footer-nextpage" href="../demand/">Demand Blocks »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.16.1 on <span class="colophon-date" title="Thursday 18 December 2025 16:17">Thursday 18 December 2025</span>. Using Julia version 1.12.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
